<!DOCTYPE html>
<html lang="en">
<!-- <head>
  <title>Bootstrap Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/cv_style.css?v=1002">
  <script src="../js/jquery-3.4.1.js"></script>
  <script src="../js/popper.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/cv_js.js?v=1011"></script>
  <link href="../fontawesome/css/all.css" rel="stylesheet">
</head> -->
<body>
<div align="center" class="container" id="content_box">
	<div class="row row-cols-2 row-cols-md-4" id="sh_product">
		  
	</div>
	<!-- The Modal -->
  <div class="modal fade" id="myModal">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 id="alt_title" class="modal-title">Message</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div id="modal_msg" class="modal-body">
          Modal body..
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>
</div>
</body>
</html>

<script type="text/javascript">
	load_p_product();
	load_p_store();


	function load_p_store(filter){
		let ft="p_store.s_status!=0";
		let txt=`<option value="0" disabled selected>เลือกร้านค้า</option>`;
			$.ajax({
				type:"POST",
				url:link,
				data:{
					"load_p_store":true,
					"filter":ft+"&&"+filter
				}
			}).done((res)=>{
				let data=JSON.parse(res);
				if(!data.msg){
					$.each(data,(i, item)=>{
						txt+=`<option value="${item.s_id}">${item.s_name}</option>`
					});
				}
				$("#s_id").html(txt);
			});
	}
	function load_p_product(filter){
			let txt="";
			$.ajax({
				type:"POST",
				url:link,
				data:{
					"load_p_product":true,
					"filter":filter
				}
			}).done((res)=>{
				var data=JSON.parse(res);
				if(!data.msg){
					$.each(data,(i, item)=>{
						let per=5;
						let img=item.p_img.split("../");
						let img1="./"+img[1];
						let css=(item.p_amount<=5?`style="background-color:#a75454;color:#fff"`:`style="background-color:#7ec282;;color:#fff"`);
						txt+=`<div class="col mb-4">
							    <div class="card">
							      <img src="${img1}" class="card-img-top" style="width:100px">
							      <div class="card-body">
							        <h5 class="card-title">${item.p_name}</h5>
							        <p class="card-text"><strike style="color:red">${parseInt	(item.p_price)+per} บาท</strike>  <br>${item.p_price} บาท <u>ถูกลง ${per} บาท</u></p>
							      </div>
							       	<div class="card-footer">
								      <small class="text-muted">
								      	<button style="color:#fff" type="button" onclick="add_cart('${item.p_id}','${item.p_amount}')" class="btn btn-info">
							        		<i class="fas fa-shopping-cart"></i></i>
							        	</button>
								      </small>
								    </div>
							    </div>
							  </div>`;

					});
				}else{
					txt=`<tr><td colspan='3'>no data</td></tr>`;
				}
				$("#sh_product").html(txt);
			});
	}
	function add_cart(id,p_amount){
		$.ajax({
				type:"POST",
				url:link,
				data:{
					"p_amount":1,
					"btn_add_cart":id
				}
		}).done((res)=>{
			let data=JSON.parse(res);
			
			if(data.status==0){
				$("#modal_msg").text(data.msg);
				$("#myModal").modal();
			}else{
				$.ajax({
						type:"POST",
						url:link,
						data:{
							"id":data,
							"load_product_cart":true
						}
				}).done((r)=>{
			let dt=JSON.parse(r);
			let txt=" ";
				$.each(dt,(i, item)=>{
					// console.log(item.p_name);
					// txt+=`<tr ${css}>
					//         <td>${i+1}</td>
					//         <td>${item.p_name}</td>
					//         <td>${item.p_amount}</td></tr>`;
				});
				$("#modal_msg").text(txt);
				$("#myModal").modal();
			});
			}
		});
	}
</script>